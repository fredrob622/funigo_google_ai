<!-- Fichier : views/pages/departements_form.ejs -->

<%- include('../partials/header', { title: title }) %>

<div class="content content-black"> 
    
    <h2>Rechercher un Département</h2>

    <!-- 
      NOUVEAU : Un formulaire unique qui entoure les listes déroulantes.
      Il soumettra les données à notre route POST.
    -->
    <form action="/departements/search" method="POST" id="dep-form">
        <div class="form-container-double" style="display: flex; justify-content: center; gap: 30px; margin-bottom: 20px; flex-wrap: wrap;">
            
            <!-- Liste déroulante par Nom -->
            <div>
                <label for="dep-nom-select" style="display: block; margin-bottom: 10px;">Par Nom :</label>
                <!-- On ajoute un 'name' pour que sa valeur soit envoyée -->
                <select id="dep-nom-select" name="nom_dep" class="dep-select" style="padding: 5px; font-size: 0.9em; border-radius: 8px; min-width: 250px;">
                    <option value="">-- Choisissez un département --</option>
                    <% listeDepartement.forEach(dep => { %>
                        <!-- On utilise 'searchTerm' pour pré-sélectionner l'option -->
                        <option value="<%= dep.nom_dep %>" data-numero="<%= dep.num_dep %>" <%= (searchTerm === dep.nom_dep) ? 'selected' : '' %>>
                            <%= dep.nom_dep %>
                        </option>
                    <% }); %>
                </select>
            </div>

            <!-- Liste déroulante par Numéro -->
            <div>
                <label for="dep-num-select" style="display: block; margin-bottom: 10px;">Par Numéro :</label>
                <!-- On ajoute un 'name' pour que sa valeur soit envoyée -->
                <select id="dep-num-select" name="num_dep" class="dep-select" style="padding: 5px; font-size: 0.9em; border-radius: 8px; min-width: 150px;">
                    <option value="">-- N° --</option>
                    <% listeDepartement.forEach(dep => { %>
                         <!-- On utilise 'searchTerm' pour pré-sélectionner l'option -->
                        <option value="<%= dep.num_dep %>" data-nom="<%= dep.nom_dep %>" <%= (searchTerm === dep.num_dep) ? 'selected' : '' %>>
                            <%= dep.num_dep %>
                        </option>
                    <% }); %>
                </select>
            </div>
        </div>
    </form>


    <!-- L'affichage des résultats reste le même -->
    <% if (results && results.length > 0) { %>
        <div class="departement-table-container" style="margin-top: 30px;">
            <h3>Résultats pour "<%= searchTerm %>"</h3>
            <table class="results-table">
                <thead>
                    <tr>
                        <th>N°</th>
                        <th>Département</th>
                        <th>Région</th>
                        <th>Superficie km²</th>
                        <th>Population</th>
                        <th>Densité</th>
                        <th>Préfecture</th>
                        <th>Pop. Préf.</th>
                        <th>Sous-Préf.</th>
                    </tr>
                </thead>
                <tbody>
                    <% results.forEach(departement => { %>
                        <tr>
                            <td><%= departement.num_dep %></td>
                            <td><%= departement.nom_dep %></td>
                            <td><%= departement.nom_reg %></td>
                            <td><%= departement.superficie %></td>
                            <td><%= departement.pop_dep %></td> 
                            <td><%= departement.densite %></td> 
                            <td><%= departement.nom_pref %></td> 
                            <td><%= departement.pop_pref %></td>
                            <td><%= departement.sous_pref %></td> 						 			 
                        </tr>  
                    <% }); %>
                </tbody>
            </table>
        </div>
    <% } else if (searchTerm) { %>
        <p>Aucun résultat trouvé pour "<%= searchTerm %>".</p>
    <% } %>
</div>


<%- include('../partials/footer') %>
